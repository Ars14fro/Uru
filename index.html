<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Fit Pro | Персональный ИИ Тренер</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Oswald:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        :root {
            --primary: #00f2ff;
            --primary-dark: #0099a3;
            --secondary: #7000ff;
            --accent: #ff00aa;
            --success: #00ff88;
            --warning: #ffaa00;
            --danger: #ff4757;
            --bg-dark: #0a0a0f;
            --bg-panel: #13131f;
            --bg-card: #1a1a2e;
            --text-main: #ffffff;
            --text-muted: #a0a0b0;
            --text-dim: #6c6c80;
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            --font-head: 'Oswald', sans-serif;
            --font-body: 'Inter', sans-serif;
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
        }

        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            outline: none; 
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: var(--font-body);
            overflow-x: hidden;
            min-height: 100vh;
            line-height: 1.6;
        }

        /* --- Background Effects --- */
        .bg-orb {
            position: fixed;
            width: 500px;
            height: 500px;
            border-radius: 50%;
            filter: blur(100px);
            z-index: -2;
            opacity: 0.4;
            animation: float 20s infinite ease-in-out;
        }
        .orb-1 { 
            top: -100px; 
            left: -100px; 
            background: var(--primary); 
            animation-delay: 0s;
        }
        .orb-2 { 
            bottom: -100px; 
            right: -100px; 
            background: var(--secondary); 
            animation-delay: 5s;
        }
        .orb-3 {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--accent);
            width: 300px;
            height: 300px;
            opacity: 0.2;
            animation-delay: 10s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(10px, 10px) scale(1.05); }
            50% { transform: translate(-5px, 15px) scale(0.95); }
            75% { transform: translate(15px, -5px) scale(1.03); }
        }

        .grid-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                linear-gradient(var(--border) 1px, transparent 1px),
                linear-gradient(90deg, var(--border) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.1;
            z-index: -1;
        }

        .particles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: var(--primary);
            border-radius: 50%;
            opacity: 0.3;
            animation: particle-float 15s infinite linear;
        }

        @keyframes particle-float {
            0% { transform: translateY(0) rotate(0deg); }
            100% { transform: translateY(-100vh) rotate(360deg); }
        }

        /* --- Navigation --- */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 5%;
            background: rgba(10, 10, 15, 0.8);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .navbar.scrolled {
            padding: 15px 5%;
            background: rgba(10, 10, 15, 0.95);
        }

        .logo {
            font-family: var(--font-head);
            font-size: 1.5rem;
            color: var(--text-main);
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            color: var(--primary);
        }

        .logo span { 
            color: var(--primary); 
            text-shadow: 0 0 10px rgba(0, 242, 255, 0.5);
        }

        .nav-links {
            display: flex;
            gap: 10px;
        }

        .nav-links button {
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 1rem;
            padding: 8px 16px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .nav-links button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .nav-links button:hover::before {
            left: 100%;
        }

        .nav-links button.active { 
            color: var(--primary); 
            background: rgba(0, 242, 255, 0.1);
        }

        .nav-links button:disabled { 
            opacity: 0.3; 
            cursor: not-allowed; 
        }

        .nav-links button .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            border: 2px solid var(--border);
            transition: all 0.3s;
        }

        .user-avatar:hover {
            transform: scale(1.05);
            border-color: var(--primary);
        }

        /* --- Screens --- */
        .app-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
            min-height: 80vh;
            position: relative;
        }

        .screen {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
            animation-duration: 0.5s;
        }

        .active-screen {
            display: block;
            animation: fadeIn 0.6s forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        /* --- Typography & Buttons --- */
        h1 { 
            font-family: var(--font-head); 
            font-size: 3.5rem; 
            line-height: 1.1; 
            margin-bottom: 20px; 
        }

        h2 { 
            font-family: var(--font-head); 
            margin-bottom: 20px; 
            color: var(--primary); 
            font-size: 2.2rem;
        }

        h3 {
            font-family: var(--font-head);
            margin-bottom: 15px;
            color: var(--text-main);
            font-size: 1.5rem;
        }

        .gradient-text {
            background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 200% 200%;
            animation: gradient-shift 3s ease infinite;
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 30px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--secondary), var(--primary));
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 25px rgba(0, 242, 255, 0.4);
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--text-muted);
            color: var(--text-muted);
        }

        .btn-secondary:hover { 
            border-color: var(--text-main); 
            color: var(--text-main); 
        }

        .btn-accent {
            background: linear-gradient(45deg, var(--accent), var(--secondary));
            color: white;
        }

        .btn-accent:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 0, 170, 0.3);
        }

        .btn-lg {
            padding: 16px 40px;
            font-size: 1.1rem;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.8rem;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- Hero Section --- */
        #screen-welcome { 
            text-align: center; 
            padding-top: 50px; 
        }

        .hero-content { 
            max-width: 800px; 
            margin: 0 auto 60px; 
        }

        .hero-content p { 
            font-size: 1.2rem; 
            color: var(--text-muted); 
            margin-bottom: 30px; 
        }

        .hero-badges {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .hero-badge {
            background: var(--bg-panel);
            padding: 10px 20px;
            border-radius: 30px;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .hero-badge i {
            color: var(--primary);
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 60px;
        }

        .feature-card {
            background: var(--bg-panel);
            padding: 30px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            transition: all 0.3s;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .feature-card:hover { 
            border-color: var(--primary); 
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        .feature-card i { 
            font-size: 2.5rem; 
            color: var(--primary); 
            margin-bottom: 15px; 
        }

        .feature-card h3 {
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .feature-card p {
            color: var(--text-muted);
            font-size: 0.95rem;
        }

        /* --- Wizard Form --- */
        .wizard-container {
            background: var(--bg-panel);
            padding: 40px;
            border-radius: var(--radius-xl);
            max-width: 800px;
            margin: 0 auto;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .wizard-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
        }

        .progress-bar-container {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 25%;
            border-radius: 3px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: progress-shine 2s infinite;
        }

        @keyframes progress-shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .wizard-step { 
            display: none; 
            animation-duration: 0.5s;
        }

        .wizard-step.active-step { 
            display: block; 
            animation-name: slideInRight;
        }

        @keyframes slideInRight {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideInLeft {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .wizard-step.prev-step {
            animation-name: slideInLeft;
        }

        .input-group { 
            margin-bottom: 25px; 
            text-align: left; 
        }

        .input-group label { 
            display: block; 
            margin-bottom: 10px; 
            font-weight: 600; 
            color: var(--text-muted); 
        }

        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            color: white;
            padding: 15px;
            border-radius: var(--radius-md);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .input-group input:focus, .input-group textarea:focus, .input-group select:focus { 
            border-color: var(--primary); 
            box-shadow: 0 0 0 2px rgba(0, 242, 255, 0.2);
        }

        .input-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .radio-group { 
            display: flex; 
            gap: 20px; 
            flex-wrap: wrap;
        }

        .radio-card {
            flex: 1;
            min-width: 120px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            padding: 20px;
            border-radius: var(--radius-md);
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .radio-card:has(input:checked) { 
            border-color: var(--primary); 
            background: rgba(0, 242, 255, 0.1); 
            transform: translateY(-5px);
        }

        .radio-card input { 
            display: none; 
        }

        .radio-card i {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .checkbox-card {
            flex: 1;
            min-width: 140px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            padding: 15px;
            border-radius: var(--radius-md);
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .checkbox-card:has(input:checked) {
            border-color: var(--primary);
            background: rgba(0, 242, 255, 0.1);
        }

        .checkbox-card input {
            display: none;
        }

        .row-2 { 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr; 
            gap: 20px; 
        }

        .row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .wizard-controls { 
            display: flex; 
            justify-content: space-between; 
            margin-top: 30px; 
        }

        .range-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .range-val {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
            color: var(--primary);
        }

        input[type="range"] {
            flex: 1;
            height: 6px;
            background: var(--bg-dark);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 242, 255, 0.5);
        }

        .form-note {
            background: rgba(0, 242, 255, 0.1);
            border-left: 3px solid var(--primary);
            padding: 10px 15px;
            margin-top: 10px;
            border-radius: 0 var(--radius-md) var(--radius-md) 0;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* --- Loading --- */
        .loader-content { 
            text-align: center; 
            margin-top: 100px; 
        }

        .spinner {
            width: 60px; 
            height: 60px;
            border: 5px solid var(--border);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            margin: 0 auto 30px;
            animation: spin 1s linear infinite;
            position: relative;
        }

        .spinner::after {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border: 5px solid transparent;
            border-top: 5px solid var(--secondary);
            border-radius: 50%;
            animation: spin 1.5s linear infinite reverse;
        }

        @keyframes spin { 
            100% { 
                transform: rotate(360deg); 
            } 
        }

        .loading-dots {
            display: inline-block;
            position: relative;
            width: 80px;
            height: 20px;
        }

        .loading-dots div {
            position: absolute;
            top: 0;
            width: 13px;
            height: 13px;
            border-radius: 50%;
            background: var(--primary);
            animation-timing-function: cubic-bezier(0, 1, 1, 0);
        }

        .loading-dots div:nth-child(1) {
            left: 8px;
            animation: loading-dots1 0.6s infinite;
        }

        .loading-dots div:nth-child(2) {
            left: 8px;
            animation: loading-dots2 0.6s infinite;
        }

        .loading-dots div:nth-child(3) {
            left: 32px;
            animation: loading-dots2 0.6s infinite;
        }

        .loading-dots div:nth-child(4) {
            left: 56px;
            animation: loading-dots3 0.6s infinite;
        }

        @keyframes loading-dots1 {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }

        @keyframes loading-dots3 {
            0% { transform: scale(1); }
            100% { transform: scale(0); }
        }

        @keyframes loading-dots2 {
            0% { transform: translate(0, 0); }
            100% { transform: translate(24px, 0); }
        }

        /* --- Plan Display --- */
        .plan-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 30px; 
            flex-wrap: wrap;
            gap: 15px;
        }

        .plan-actions {
            display: flex;
            gap: 10px;
        }

        .plan-grid { 
            display: grid; 
            gap: 30px; 
        }

        .day-card {
            background: var(--bg-panel);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .day-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        .day-header {
            background: rgba(255,255,255,0.05);
            padding: 15px 25px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .day-header h3 { 
            font-family: var(--font-head); 
            color: var(--primary); 
            margin: 0; 
            font-size: 1.3rem;
        }

        .day-body { 
            padding: 25px; 
        }

        .exercise-item {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
            gap: 15px;
        }

        .exercise-item:last-child { 
            border: none; 
        }

        .ex-name { 
            font-weight: bold; 
            font-size: 1.1rem; 
        }

        .ex-name small { 
            display: block; 
            color: var(--text-muted); 
            font-size: 0.85rem; 
            font-weight: normal; 
            margin-top: 5px; 
        }

        .ex-meta { 
            color: var(--secondary); 
            font-family: var(--font-head); 
            text-align: center;
        }

        .ex-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .ex-action-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-muted);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .ex-action-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* --- Stats Dashboard --- */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-panel);
            padding: 20px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin: 10px 0;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .stat-change {
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .positive {
            color: var(--success);
        }

        .negative {
            color: var(--danger);
        }

        /* --- Progress Tracking --- */
        .progress-section {
            background: var(--bg-panel);
            padding: 25px;
            border-radius: var(--radius-lg);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }

        .progress-chart {
            height: 200px;
            margin-top: 20px;
            position: relative;
        }

        .measurement-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .measurement-input {
            display: flex;
            flex-direction: column;
        }

        .measurement-input label {
            margin-bottom: 5px;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* --- Nutrition Section --- */
        .nutrition-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .nutrition-card {
            background: var(--bg-panel);
            border-radius: var(--radius-lg);
            padding: 20px;
            border: 1px solid var(--border);
        }

        .macros {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .macro {
            text-align: center;
            flex: 1;
        }

        .macro-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .macro-label {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .protein { color: var(--primary); }
        .carbs { color: var(--warning); }
        .fats { color: var(--accent); }

        .meal-plan {
            margin-top: 20px;
        }

        .meal-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .meal-item:last-child {
            border-bottom: none;
        }

        /* --- Chat --- */
        .chat-container {
            background: var(--bg-panel);
            border-radius: var(--radius-xl);
            height: 70vh;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border);
            max-width: 1000px;
            margin: 0 auto;
            overflow: hidden;
        }

        .chat-header { 
            padding: 20px; 
            border-bottom: 1px solid var(--border); 
            display: flex; 
            gap: 15px; 
            align-items: center; 
            background: rgba(255,255,255,0.02);
        }

        .avatar img { 
            width: 50px; 
            height: 50px; 
            border-radius: 50%; 
            border: 2px solid var(--primary); 
        }

        .status { 
            font-size: 0.8rem; 
            color: var(--success); 
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            display: inline-block;
        }

        .chat-history { 
            flex: 1; 
            overflow-y: auto; 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
        }

        .message {
            max-width: 80%;
            padding: 15px;
            border-radius: 15px;
            line-height: 1.5;
            font-size: 0.95rem;
            position: relative;
            animation: messageAppear 0.3s ease;
        }

        @keyframes messageAppear {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.bot { 
            background: rgba(255,255,255,0.1); 
            border-top-left-radius: 0; 
            align-self: flex-start; 
        }

        .message.user { 
            background: var(--primary-dark); 
            border-top-right-radius: 0; 
            align-self: flex-end; 
            color: white; 
        }

        .message-time {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 5px;
            text-align: right;
        }

        .chat-input-area { 
            padding: 20px; 
            border-top: 1px solid var(--border); 
            display: flex; 
            gap: 10px; 
            background: rgba(255,255,255,0.02);
        }

        #chat-input { 
            flex: 1; 
            background: var(--bg-dark); 
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 12px 15px;
            color: white;
        }

        #send-msg-btn { 
            width: 50px; 
            background: var(--primary); 
            border: none; 
            border-radius: var(--radius-md); 
            cursor: pointer; 
            color: var(--bg-dark); 
            font-size: 1.2rem; 
            transition: all 0.3s;
        }

        #send-msg-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .chat-actions {
            display: flex;
            gap: 10px;
        }

        /* --- Community Section --- */
        .community-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .community-card {
            background: var(--bg-panel);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .community-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .community-body {
            padding: 20px;
        }

        .user-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .user-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: var(--radius-md);
            transition: all 0.3s;
        }

        .user-item:hover {
            background: rgba(255,255,255,0.05);
        }

        .user-avatar-sm {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: bold;
        }

        .user-level {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* --- Settings Section --- */
        .settings-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 30px;
        }

        .settings-nav {
            background: var(--bg-panel);
            border-radius: var(--radius-lg);
            padding: 20px;
            border: 1px solid var(--border);
            height: fit-content;
        }

        .settings-nav-item {
            padding: 12px 15px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .settings-nav-item.active {
            background: rgba(0, 242, 255, 0.1);
            color: var(--primary);
        }

        .settings-nav-item:hover:not(.active) {
            background: rgba(255,255,255,0.05);
        }

        .settings-content {
            background: var(--bg-panel);
            border-radius: var(--radius-lg);
            padding: 30px;
            border: 1px solid var(--border);
        }

        .settings-section {
            display: none;
        }

        .settings-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-dark);
            border: 1px solid var(--border);
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 3px;
            background-color: var(--text-muted);
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary);
            border-color: var(--primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
            background-color: white;
        }

        /* --- Notifications --- */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 400px;
        }

        .notification {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 15px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideInRight 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
        }

        .notification.success::before {
            background: var(--success);
        }

        .notification.error::before {
            background: var(--danger);
        }

        .notification.warning::before {
            background: var(--warning);
        }

        .notification.info::before {
            background: var(--primary);
        }

        .notification-icon {
            font-size: 1.2rem;
        }

        .notification.success .notification-icon {
            color: var(--success);
        }

        .notification.error .notification-icon {
            color: var(--danger);
        }

        .notification.warning .notification-icon {
            color: var(--warning);
        }

        .notification.info .notification-icon {
            color: var(--primary);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .notification-message {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1rem;
        }

        /* --- Modal --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-panel);
            border-radius: var(--radius-xl);
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            transform: scale(0.9);
            transition: all 0.3s;
            position: relative;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-close:hover {
            color: var(--text-main);
        }

        /* --- Responsive --- */
        @media (max-width: 768px) {
            .row-2, .row-3, .form-row { 
                grid-template-columns: 1fr; 
            }

            .exercise-item { 
                grid-template-columns: 1fr; 
                gap: 10px; 
                text-align: center;
            }

            .ex-actions {
                justify-content: center;
            }

            h1 { 
                font-size: 2.5rem; 
            }

            .navbar {
                flex-direction: column;
                gap: 15px;
                padding: 15px 5%;
            }

            .nav-links {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }

            .user-menu {
                width: 100%;
                justify-content: center;
            }

            .settings-container {
                grid-template-columns: 1fr;
            }

            .wizard-container {
                padding: 20px;
            }

            .chat-container {
                height: 80vh;
            }
        }

        /* --- Utility Classes --- */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mb-0 { margin-bottom: 0; }
        .mb-10 { margin-bottom: 10px; }
        .mb-20 { margin-bottom: 20px; }
        .mb-30 { margin-bottom: 30px; }
        .mt-10 { margin-top: 10px; }
        .mt-20 { margin-top: 20px; }
        .mt-30 { margin-top: 30px; }
        .p-20 { padding: 20px; }
        .d-flex { display: flex; }
        .align-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .flex-1 { flex: 1; }
        .gap-10 { gap: 10px; }
        .gap-15 { gap: 15px; }
        .gap-20 { gap: 20px; }
        .w-100 { width: 100%; }
        .hidden { display: none; }

        /* --- Dark mode support --- */
        @media (prefers-color-scheme: light) {
            :root {
                --bg-dark: #f0f2f5;
                --bg-panel: #ffffff;
                --bg-card: #f8f9fa;
                --text-main: #2c3e50;
                --text-muted: #6c757d;
                --text-dim: #95a5a6;
                --border: rgba(0, 0, 0, 0.1);
                --glass: rgba(0, 0, 0, 0.05);
            }
        }

        /* --- Print styles --- */
        @media print {
            .navbar, .bg-orb, .grid-overlay, .particles-container, .btn {
                display: none !important;
            }

            body {
                background: white;
                color: black;
            }

            .screen {
                display: block !important;
                opacity: 1 !important;
            }

            .plan-grid {
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>

    <div class="bg-orb orb-1"></div>
    <div class="bg-orb orb-2"></div>
    <div class="bg-orb orb-3"></div>
    <div class="grid-overlay"></div>
    <div class="particles-container" id="particles-container"></div>

    <nav class="navbar" id="navbar">
        <div class="logo">
            <i class="fa-solid fa-dumbbell"></i> AI-Fit<span>Pro</span>
        </div>
        <div class="nav-links">
            <button id="nav-home" class="active">
                <i class="fa-solid fa-home"></i> Главная
            </button>
            <button id="nav-plan" disabled>
                <i class="fa-solid fa-dumbbell"></i> Мой План
            </button>
            <button id="nav-progress" disabled>
                <i class="fa-solid fa-chart-line"></i> Прогресс
            </button>
            <button id="nav-nutrition" disabled>
                <i class="fa-solid fa-apple-whole"></i> Питание
            </button>
            <button id="nav-chat" disabled>
                <i class="fa-solid fa-robot"></i> Чат с ИИ
                <span class="badge">3</span>
            </button>
            <button id="nav-community" disabled>
                <i class="fa-solid fa-users"></i> Сообщество
            </button>
            <button id="nav-settings">
                <i class="fa-solid fa-gear"></i> Настройки
            </button>
        </div>
        <div class="user-menu">
            <div class="user-avatar" id="user-avatar">
                <i class="fa-solid fa-user"></i>
            </div>
        </div>
    </nav>

    <main class="app-container">
        
        <!-- Экран приветствия -->
        <section id="screen-welcome" class="screen active-screen">
            <div class="hero-content">
                <h1>Трансформация тела с <span class="gradient-text">Gemini 2.5 Pro</span></h1>
                <p>Персональный план тренировок и питания, созданный искусственным интеллектом на основе твоей физиологии, целей и ограничений.</p>
                <button class="btn-primary btn-lg" onclick="app.startOnboarding()">
                    <i class="fa-solid fa-play"></i> Начать трансформацию
                </button>
                
                <div class="hero-badges">
                    <div class="hero-badge">
                        <i class="fa-solid fa-shield-alt"></i> Безопасные тренировки
                    </div>
                    <div class="hero-badge">
                        <i class="fa-solid fa-bolt"></i> Адаптация под тебя
                    </div>
                    <div class="hero-badge">
                        <i class="fa-solid fa-chart-line"></i> Отслеживание прогресса
                    </div>
                </div>
            </div>
            <div class="features-grid">
                <div class="feature-card">
                    <i class="fa-solid fa-brain"></i>
                    <h3>Умный анализ</h3>
                    <p>Учитывает травмы, опыт, цели и образ жизни для создания идеального плана.</p>
                </div>
                <div class="feature-card">
                    <i class="fa-solid fa-dumbbell"></i>
                    <h3>Персональные тренировки</h3>
                    <p>План под любой инвентарь: от полного зала до домашних условий.</p>
                </div>
                <div class="feature-card">
                    <i class="fa-solid fa-apple-whole"></i>
                    <h3>Индивидуальное питание</h3>
                    <p>Рекомендации по БЖУ, калориям и времени приёмов пищи.</p>
                </div>
                <div class="feature-card">
                    <i class="fa-solid fa-chart-bar"></i>
                    <h3>Детальная аналитика</h3>
                    <p>Отслеживание прогресса, веса, замеров и силовых показателей.</p>
                </div>
                <div class="feature-card">
                    <i class="fa-solid fa-robot"></i>
                    <h3>ИИ-помощник 24/7</h3>
                    <p>Ответы на вопросы, коррекция плана и мотивационная поддержка.</p>
                </div>
                <div class="feature-card">
                    <i class="fa-solid fa-users"></i>
                    <h3>Сообщество</h3>
                    <p>Общайтесь, делитесь успехами и соревнуйтесь с другими пользователями.</p>
                </div>
            </div>
        </section>

        <!-- Экран onboarding (анкетирование) -->
        <section id="screen-onboarding" class="screen">
            <div class="wizard-container">
                <div class="progress-bar-container">
                    <div class="progress-bar" id="wizard-progress"></div>
                </div>
                
                <form id="onboarding-form">
                    <!-- Шаг 1: Базовая информация -->
                    <div class="wizard-step active-step" data-step="1">
                        <h2>Основная информация</h2>
                        <p class="text-muted mb-20">Помогите ИИ понять вашу отправную точку</p>
                        
                        <div class="input-group">
                            <label>Пол</label>
                            <div class="radio-group">
                                <label class="radio-card">
                                    <input type="radio" name="gender" value="Мужской" checked>
                                    <i class="fa-solid fa-mars"></i>
                                    <span>Мужской</span>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="gender" value="Женский">
                                    <i class="fa-solid fa-venus"></i>
                                    <span>Женский</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="row-2">
                            <div class="input-group">
                                <label>Возраст</label>
                                <input type="number" name="age" placeholder="25" min="10" max="100" required>
                            </div>
                            <div class="input-group">
                                <label>Вес (кг)</label>
                                <input type="number" name="weight" placeholder="75" min="30" max="200" step="0.1" required>
                            </div>
                            <div class="input-group">
                                <label>Рост (см)</label>
                                <input type="number" name="height" placeholder="180" min="100" max="250" required>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label>Тип телосложения</label>
                            <div class="radio-group">
                                <label class="radio-card">
                                    <input type="radio" name="body_type" value="Эктоморф" checked>
                                    <i class="fa-solid fa-person"></i>
                                    <span>Эктоморф</span>
                                    <small>Худощавое телосложение</small>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="body_type" value="Мезоморф">
                                    <i class="fa-solid fa-person"></i>
                                    <span>Мезоморф</span>
                                    <small>Атлетическое телосложение</small>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="body_type" value="Эндоморф">
                                    <i class="fa-solid fa-person"></i>
                                    <span>Эндоморф</span>
                                    <small>Крупное телосложение</small>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Шаг 2: Место тренировок и инвентарь -->
                    <div class="wizard-step" data-step="2">
                        <h2>Условия тренировок</h2>
                        <p class="text-muted mb-20">Где и с чем вы планируете тренироваться</p>
                        
                        <div class="input-group">
                            <label>Место занятий</label>
                            <select name="location" required>
                                <option value="Тренажерный зал">Тренажерный зал (полный доступ)</option>
                                <option value="Дома">Дома (ограниченный инвентарь)</option>
                                <option value="Улица/Воркаут">Улица / Воркаут площадка</option>
                                <option value="Смешанный">Смешанный формат</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label>Доступный инвентарь</label>
                            <div class="checkbox-group">
                                <label class="checkbox-card">
                                    <input type="checkbox" name="equipment" value="Гантели">
                                    <span>Гантели</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="equipment" value="Штанга">
                                    <span>Штанга</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="equipment" value="Турник/Брусья">
                                    <span>Турник/Брусья</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="equipment" value="Резинки">
                                    <span>Резинки</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="equipment" value="Тренажеры">
                                    <span>Тренажеры</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="equipment" value="Собственный вес">
                                    <span>Собственный вес</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label>Дополнительный инвентарь или ограничения</label>
                            <textarea name="equipment_notes" placeholder="Например: гантели до 10кг, нет штанги, есть резинки разной жесткости..."></textarea>
                        </div>
                    </div>

                    <!-- Шаг 3: Опыт и здоровье -->
                    <div class="wizard-step" data-step="3">
                        <h2>Опыт и здоровье</h2>
                        <p class="text-muted mb-20">Ваш уровень подготовки и медицинские особенности</p>
                        
                        <div class="input-group">
                            <label>Уровень подготовки</label>
                            <select name="level" required>
                                <option value="Новичок">Новичок (0-6 месяцев)</option>
                                <option value="Начинающий">Начинающий (6-12 месяцев)</option>
                                <option value="Средний">Средний (1-3 года)</option>
                                <option value="Продвинутый">Продвинутый (3+ года)</option>
                                <option value="Профессионал">Профессионал (5+ лет)</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label>Частота тренировок в прошлом</label>
                            <div class="radio-group">
                                <label class="radio-card">
                                    <input type="radio" name="previous_frequency" value="Не тренировался" checked>
                                    <span>Не тренировался</span>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="previous_frequency" value="1-2 раза в неделю">
                                    <span>1-2 раза в неделю</span>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="previous_frequency" value="3-4 раза в неделю">
                                    <span>3-4 раза в неделю</span>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="previous_frequency" value="5+ раз в неделю">
                                    <span>5+ раз в неделю</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label>Травмы или медицинские ограничения</label>
                            <textarea name="injuries" placeholder="Боли в коленях, грыжа, астма, гипертония... Если нет, пиши 'Здоров'"></textarea>
                            <div class="form-note">
                                <i class="fa-solid fa-info-circle"></i> Эта информация поможет избежать опасных упражнений
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label>Принимаемые лекарства или добавки</label>
                            <textarea name="medications" placeholder="Витамины, протеин, лекарства..."></textarea>
                        </div>
                    </div>

                    <!-- Шаг 4: Цели и предпочтения -->
                    <div class="wizard-step" data-step="4">
                        <h2>Цели и предпочтения</h2>
                        <p class="text-muted mb-20">Чего вы хотите достичь и как вам нравится тренироваться</p>
                        
                        <div class="input-group">
                            <label>Основная цель</label>
                            <select name="goal" required>
                                <option value="Похудение">Похудение / Сжигание жира</option>
                                <option value="Набор массы">Набор мышечной массы</option>
                                <option value="Рельеф">Проработка рельефа / Сушка</option>
                                <option value="Сила">Развитие силы</option>
                                <option value="Выносливость">Выносливость / Функциональность</option>
                                <option value="Тонус">Общий тонус и здоровье</option>
                                <option value="Подготовка к событию">Подготовка к событию</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label>Специфические цели</label>
                            <div class="checkbox-group">
                                <label class="checkbox-card">
                                    <input type="checkbox" name="specific_goals" value="Укрепить спину">
                                    <span>Укрепить спину</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="specific_goals" value="Убрать живот">
                                    <span>Убрать живот</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="specific_goals" value="Увеличить плечи">
                                    <span>Увеличить плечи</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="specific_goals" value="Укрепить ноги">
                                    <span>Укрепить ноги</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="specific_goals" value="Улучшить осанку">
                                    <span>Улучшить осанку</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="specific_goals" value="Повысить выносливость">
                                    <span>Повысить выносливость</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label>Предпочтительный тип тренировок</label>
                            <div class="checkbox-group">
                                <label class="checkbox-card">
                                    <input type="checkbox" name="training_preferences" value="Силовые">
                                    <span>Силовые</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="training_preferences" value="Кардио">
                                    <span>Кардио</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="training_preferences" value="Круговые">
                                    <span>Круговые</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="training_preferences" value="Функциональные">
                                    <span>Функциональные</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="training_preferences" value="Йога/Растяжка">
                                    <span>Йога/Растяжка</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="training_preferences" value="ВИИТ">
                                    <span>ВИИТ</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Шаг 5: График и интенсивность -->
                    <div class="wizard-step" data-step="5">
                        <h2>График и интенсивность</h2>
                        <p class="text-muted mb-20">Как часто и интенсивно вы готовы тренироваться</p>
                        
                        <div class="input-group">
                            <label>Дней тренировок в неделю</label>
                            <div class="range-container">
                                <input type="range" name="days_per_week" min="1" max="7" value="3" oninput="document.getElementById('days-val').innerText = this.value">
                                <span class="range-val" id="days-val">3</span>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label>Длительность тренировки (минут)</label>
                            <select name="duration" required>
                                <option value="30">30 мин (Короткая)</option>
                                <option value="45">45 мин (Оптимальная)</option>
                                <option value="60" selected>60 мин (Стандарт)</option>
                                <option value="75">75 мин (Продвинутая)</option>
                                <option value="90">90+ мин (Интенсивная)</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label>Предпочтительное время тренировок</label>
                            <div class="radio-group">
                                <label class="radio-card">
                                    <input type="radio" name="training_time" value="Утро" checked>
                                    <span>Утро (6-10)</span>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="training_time" value="День">
                                    <span>День (10-16)</span>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="training_time" value="Вечер">
                                    <span>Вечер (16-20)</span>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="training_time" value="Ночь">
                                    <span>Ночь (20-23)</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label>Уровень интенсивности</label>
                            <div class="radio-group">
                                <label class="radio-card">
                                    <input type="radio" name="intensity" value="Низкий" checked>
                                    <span>Низкий</span>
                                    <small>Для начинающих</small>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="intensity" value="Средний">
                                    <span>Средний</span>
                                    <small>Комфортный рост</small>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="intensity" value="Высокий">
                                    <span>Высокий</span>
                                    <small>Максимальный результат</small>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Шаг 6: Питание и образ жизни -->
                    <div class="wizard-step" data-step="6">
                        <h2>Питание и образ жизни</h2>
                        <p class="text-muted mb-20">Информация для создания плана питания</p>
                        
                        <div class="input-group">
                            <label>Тип питания</label>
                            <select name="diet_type" required>
                                <option value="Всеядное">Всеядное</option>
                                <option value="Вегетарианское">Вегетарианское</option>
                                <option value="Веганское">Веганское</option>
                                <option value="Палео">Палео</option>
                                <option value="Кето">Кето</option>
                                <option value="Низкоуглеводное">Низкоуглеводное</option>
                                <option value="Другое">Другое</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label>Аллергии и непереносимости</label>
                            <textarea name="allergies" placeholder="Молочные продукты, глютен, орехи..."></textarea>
                        </div>
                        
                        <div class="input-group">
                            <label>Предпочтения в еде</label>
                            <textarea name="food_preferences" placeholder="Люблю/Не люблю определенные продукты..."></textarea>
                        </div>
                        
                        <div class="input-group">
                            <label>Образ жизни</label>
                            <div class="radio-group">
                                <label class="radio-card">
                                    <input type="radio" name="lifestyle" value="Сидячий" checked>
                                    <span>Сидячий</span>
                                    <small>Офисная работа</small>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="lifestyle" value="Умеренный">
                                    <span>Умеренный</span>
                                    <small>Легкая активность</small>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="lifestyle" value="Активный">
                                    <span>Активный</span>
                                    <small>Постоянное движение</small>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="lifestyle" value="Очень активный">
                                    <span>Очень активный</span>
                                    <small>Физическая работа</small>
                                </label>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label>Качество сна</label>
                            <div class="radio-group">
                                <label class="radio-card">
                                    <input type="radio" name="sleep_quality" value="Плохое" checked>
                                    <span>Плохое</span>
                                    <small>Менее 6 часов</small>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="sleep_quality" value="Нормальное">
                                    <span>Нормальное</span>
                                    <small>6-7 часов</small>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="sleep_quality" value="Хорошее">
                                    <span>Хорошее</span>
                                    <small>7-8 часов</small>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="sleep_quality" value="Отличное">
                                    <span>Отличное</span>
                                    <small>8+ часов</small>
                                </label>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label>Уровень стресса</label>
                            <div class="radio-group">
                                <label class="radio-card">
                                    <input type="radio" name="stress_level" value="Низкий" checked>
                                    <span>Низкий</span>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="stress_level" value="Средний">
                                    <span>Средний</span>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="stress_level" value="Высокий">
                                    <span>Высокий</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Шаг 7: Мотивация и ожидания -->
                    <div class="wizard-step" data-step="7">
                        <h2>Мотивация и ожидания</h2>
                        <p class="text-muted mb-20">Помогите ИИ понять вашу мотивацию</p>
                        
                        <div class="input-group">
                            <label>Основной источник мотивации</label>
                            <div class="radio-group">
                                <label class="radio-card">
                                    <input type="radio" name="motivation" value="Внешность" checked>
                                    <span>Внешность</span>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="motivation" value="Здоровье">
                                    <span>Здоровье</span>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="motivation" value="Спортивные результаты">
                                    <span>Спортивные результаты</span>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="motivation" value="Саморазвитие">
                                    <span>Саморазвитие</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label>Что вас демотивирует?</label>
                            <div class="checkbox-group">
                                <label class="checkbox-card">
                                    <input type="checkbox" name="demotivators" value="Отсутствие результата">
                                    <span>Отсутствие результата</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="demotivators" value="Сложность упражнений">
                                    <span>Сложность упражнений</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="demotivators" value="Нехватка времени">
                                    <span>Нехватка времени</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="demotivators" value="Усталость">
                                    <span>Усталость</span>
                                </label>
                                <label class="checkbox-card">
                                    <input type="checkbox" name="demotivators" value="Отсутствие поддержки">
                                    <span>Отсутствие поддержки</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label>Ожидаемые сроки достижения цели</label>
                            <select name="timeframe" required>
                                <option value="1 месяц">1 месяц</option>
                                <option value="3 месяца" selected>3 месяца</option>
                                <option value="6 месяцев">6 месяцев</option>
                                <option value="1 год">1 год</option>
                                <option value="Не определены">Не определены</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label>Дополнительные пожелания или комментарии</label>
                            <textarea name="additional_notes" placeholder="Что-то важное, что мы не спросили..."></textarea>
                        </div>
                    </div>

                    <div class="wizard-controls">
                        <button type="button" class="btn-secondary" id="prev-btn" style="display:none;">
                            <i class="fa-solid fa-arrow-left"></i> Назад
                        </button>
                        <button type="button" class="btn-primary" id="next-btn">
                            Далее <i class="fa-solid fa-arrow-right"></i>
                        </button>
                        <button type="submit" class="btn-primary" id="submit-btn" style="display:none;">
                            Создать Персональный План <i class="fa-solid fa-magic"></i>
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Экран загрузки -->
        <section id="screen-loading" class="screen">
            <div class="loader-content">
                <div class="spinner"></div>
                <h2>Gemini 2.5 Pro анализирует ваши данные...</h2>
                <p id="loading-text">Составляем индивидуальную программу...</p>
                <div class="loading-dots">
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
            </div>
        </section>

        <!-- Экран плана тренировок -->
        <section id="screen-plan" class="screen">
            <div class="plan-header">
                <div>
                    <h2>Твой план тренировок</h2>
                    <p class="text-muted">Персональная программа, созданная ИИ специально для вас</p>
                </div>
                <div class="plan-actions">
                    <button class="btn-secondary btn-sm" onclick="app.regeneratePlan()">
                        <i class="fa-solid fa-refresh"></i> Обновить
                    </button>
                    <button class="btn-secondary btn-sm" onclick="app.downloadPDF()">
                        <i class="fa-solid fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn-primary btn-sm" onclick="app.sharePlan()">
                        <i class="fa-solid fa-share"></i> Поделиться
                    </button>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Тренировок в неделю</div>
                    <div class="stat-value" id="stat-workouts">3</div>
                    <div class="stat-change positive">+1 с прошлой недели</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Средняя продолжительность</div>
                    <div class="stat-value" id="stat-duration">60<small>мин</small></div>
                    <div class="stat-change positive">+5 мин</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Сожжено калорий</div>
                    <div class="stat-value" id="stat-calories">1,240</div>
                    <div class="stat-change positive">+15%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Прогресс выполнения</div>
                    <div class="stat-value" id="stat-progress">72<small>%</small></div>
                    <div class="stat-change positive">+8%</div>
                </div>
            </div>
            
            <div id="plan-container" class="plan-grid">
                <!-- План будет загружен сюда динамически -->
            </div>
        </section>

        <!-- Экран прогресса -->
        <section id="screen-progress" class="screen">
            <div class="plan-header">
                <h2>Твой прогресс</h2>
                <button class="btn-primary btn-sm" onclick="app.logProgress()">
                    <i class="fa-solid fa-plus"></i> Добавить замеры
                </button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Текущий вес</div>
                    <div class="stat-value" id="stat-current-weight">75.5<small>кг</small></div>
                    <div class="stat-change positive">-1.2 кг за месяц</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Мышечная масса</div>
                    <div class="stat-value" id="stat-muscle-mass">35.2<small>кг</small></div>
                    <div class="stat-change positive">+0.8 кг</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Жировой процент</div>
                    <div class="stat-value" id="stat-fat-percent">18.5<small>%</small></div>
                    <div class="stat-change positive">-2.1%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Общий прогресс</div>
                    <div class="stat-value" id="stat-overall-progress">64<small>%</small></div>
                    <div class="stat-change positive">+12%</div>
                </div>
            </div>
            
            <div class="progress-section">
                <h3>Динамика веса</h3>
                <div class="progress-chart" id="weight-chart">
                    <!-- График будет здесь -->
                </div>
            </div>
            
            <div class="progress-section">
                <h3>Последние замеры</h3>
                <div class="measurement-form">
                    <div class="measurement-input">
                        <label>Вес (кг)</label>
                        <input type="number" step="0.1" id="input-weight" placeholder="75.5">
                    </div>
                    <div class="measurement-input">
                        <label>Обхват груди (см)</label>
                        <input type="number" step="0.1" id="input-chest" placeholder="98.5">
                    </div>
                    <div class="measurement-input">
                        <label>Обхват талии (см)</label>
                        <input type="number" step="0.1" id="input-waist" placeholder="84.2">
                    </div>
                    <div class="measurement-input">
                        <label>Обхват бедер (см)</label>
                        <input type="number" step="0.1" id="input-hips" placeholder="102.3">
                    </div>
                    <div class="measurement-input">
                        <label>Обхват бицепса (см)</label>
                        <input type="number" step="0.1" id="input-biceps" placeholder="35.8">
                    </div>
                    <div class="measurement-input">
                        <label>Дата замера</label>
                        <input type="date" id="input-date">
                    </div>
                </div>
                <button class="btn-primary mt-20" onclick="app.saveMeasurements()">
                    <i class="fa-solid fa-save"></i> Сохранить замеры
                </button>
            </div>
        </section>

        <!-- Экран питания -->
        <section id="screen-nutrition" class="screen">
            <div class="plan-header">
                <h2>Твое питание</h2>
                <button class="btn-primary btn-sm" onclick="app.generateMealPlan()">
                    <i class="fa-solid fa-utensils"></i> Обновить план
                </button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Дневная норма калорий</div>
                    <div class="stat-value" id="stat-calories-target">2250</div>
                    <div class="stat-change">На поддержание</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Белки</div>
                    <div class="stat-value" id="stat-protein">140<small>г</small></div>
                    <div class="stat-change">25% от нормы</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Углеводы</div>
                    <div class="stat-value" id="stat-carbs">280<small>г</small></div>
                    <div class="stat-change">45% от нормы</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Жиры</div>
                    <div class="stat-value" id="stat-fats">62<small>г</small></div>
                    <div class="stat-change">30% от нормы</div>
                </div>
            </div>
            
            <div class="nutrition-grid">
                <div class="nutrition-card">
                    <h3>Распределение БЖУ</h3>
                    <div class="macros">
                        <div class="macro">
                            <div class="macro-value protein">140г</div>
                            <div class="macro-label">Белки</div>
                        </div>
                        <div class="macro">
                            <div class="macro-value carbs">280г</div>
                            <div class="macro-label">Углеводы</div>
                        </div>
                        <div class="macro">
                            <div class="macro-value fats">62г</div>
                            <div class="macro-label">Жиры</div>
                        </div>
                    </div>
                </div>
                
                <div class="nutrition-card">
                    <h3>Рекомендации по питанию</h3>
                    <ul>
                        <li>Пейте 2-3 литра воды в день</li>
                        <li>Ешьте белок с каждым приемом пищи</li>
                        <li>Ограничьте сахар и обработанные продукты</li>
                        <li>Употребляйте овощи с каждым приемом пищи</li>
                    </ul>
                </div>
            </div>
            
            <div class="nutrition-card mt-30">
                <h3>Примерный план питания на день</h3>
                <div class="meal-plan">
                    <div class="meal-item">
                        <div class="meal-name">Завтрак (8:00)</div>
                        <div class="meal-details">Овсянка с ягодами и протеином - 450 ккал</div>
                    </div>
                    <div class="meal-item">
                        <div class="meal-name">Перекус (11:00)</div>
                        <div class="meal-details">Греческий йогурт с орехами - 280 ккал</div>
                    </div>
                    <div class="meal-item">
                        <div class="meal-name">Обед (14:00)</div>
                        <div class="meal-details">Куриная грудка с гречкой и овощами - 550 ккал</div>
                    </div>
                    <div class="meal-item">
                        <div class="meal-name">Перекус (17:00)</div>
                        <div class="meal-details">Творог с бананом - 320 ккал</div>
                    </div>
                    <div class="meal-item">
                        <div class="meal-name">Ужин (20:00)</div>
                        <div class="meal-details">Рыба на пару с салатом - 400 ккал</div>
                    </div>
                    <div class="meal-item">
                        <div class="meal-name">Итого</div>
                        <div class="meal-details"><strong>2000 ккал</strong></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Экран чата с ИИ -->
        <section id="screen-chat" class="screen">
            <div class="chat-container">
                <div class="chat-header">
                    <div class="avatar">
                        <img src="https://cdn-icons-png.flaticon.com/512/4712/4712035.png" alt="AI">
                    </div>
                    <div class="info">
                        <h3>Тренер Gemini 2.5 Pro</h3>
                        <span class="status">Онлайн</span>
                    </div>
                    <div class="chat-actions">
                        <button class="btn-icon btn-secondary" onclick="app.clearChat()" title="Очистить историю">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                        <button class="btn-icon btn-secondary" onclick="app.voiceInput()" title="Голосовой ввод">
                            <i class="fa-solid fa-microphone"></i>
                        </button>
                    </div>
                </div>
                <div class="chat-history" id="chat-history">
                    <div class="message bot">
                        Привет! Я ваш персональный ИИ-тренер. Я изучил ваши данные и готов ответить на любые вопросы о тренировках, питании или прогрессе. Чем могу помочь?
                        <div class="message-time">Сегодня, 10:30</div>
                    </div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="chat-input" placeholder="Спросите о чем угодно: технике упражнений, питании, восстановлении...">
                    <button id="send-msg-btn"><i class="fa-solid fa-paper-plane"></i></button>
                </div>
            </div>
        </section>

        <!-- Экран сообщества -->
        <section id="screen-community" class="screen">
            <div class="plan-header">
                <h2>Сообщество AI-Fit Pro</h2>
                <button class="btn-primary btn-sm" onclick="app.createPost()">
                    <i class="fa-solid fa-plus"></i> Новая запись
                </button>
            </div>
            
            <div class="community-grid">
                <div class="community-card">
                    <div class="community-header">
                        <h3>Активные пользователи</h3>
                    </div>
                    <div class="community-body">
                        <div class="user-list">
                            <div class="user-item">
                                <div class="user-avatar-sm">МК</div>
                                <div class="user-info">
                                    <div class="user-name">Мария К.</div>
                                    <div class="user-level">Похудение • 12 недель</div>
                                </div>
                                <div class="user-progress positive">-8.2кг</div>
                            </div>
                            <div class="user-item">
                                <div class="user-avatar-sm">АС</div>
                                <div class="user-info">
                                    <div class="user-name">Алексей С.</div>
                                    <div class="user-level">Набор массы • 8 недель</div>
                                </div>
                                <div class="user-progress positive">+4.5кг</div>
                            </div>
                            <div class="user-item">
                                <div class="user-avatar-sm">ДВ</div>
                                <div class="user-info">
                                    <div class="user-name">Дарья В.</div>
                                    <div class="user-level">Тонус • 16 недель</div>
                                </div>
                                <div class="user-progress positive">-5.1кг</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="community-card">
                    <div class="community-header">
                        <h3>Мои достижения</h3>
                    </div>
                    <div class="community-body">
                        <div class="achievement-list">
                            <div class="user-item">
                                <i class="fa-solid fa-dumbbell" style="color: var(--primary);"></i>
                                <div class="user-info">
                                    <div class="user-name">Первая тренировка</div>
                                    <div class="user-level">Завершено 5 тренировок</div>
                                </div>
                            </div>
                            <div class="user-item">
                                <i class="fa-solid fa-fire" style="color: var(--accent);"></i>
                                <div class="user-info">
                                    <div class="user-name">Неделя активности</div>
                                    <div class="user-level">Тренировался 7 дней подряд</div>
                                </div>
                            </div>
                            <div class="user-item">
                                <i class="fa-solid fa-weight-scale" style="color: var(--success);"></i>
                                <div class="user-info">
                                    <div class="user-name">Первые результаты</div>
                                    <div class="user-level">Потерял 2 кг за месяц</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="community-card mt-30">
                <div class="community-header">
                    <h3>Лента сообщества</h3>
                </div>
                <div class="community-body">
                    <div class="user-item">
                        <div class="user-avatar-sm">МК</div>
                        <div class="user-info">
                            <div class="user-name">Мария К.</div>
                            <div class="user-level">2 часа назад</div>
                            <p>Сегодня установила личный рекорд в жиме ногами! 120кг на 8 повторений! Спасибо AI-Fit Pro за отличную программу! 💪</p>
                        </div>
                    </div>
                    <div class="user-item">
                        <div class="user-avatar-sm">АС</div>
                        <div class="user-info">
                            <div class="user-name">Алексей С.</div>
                            <div class="user-level">5 часов назад</div>
                            <p>Прошел половину пути к своей цели! За 2 месяца набрал 3кг чистой массы. Продолжаем в том же духе! 🚀</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Экран настроек -->
        <section id="screen-settings" class="screen">
            <div class="settings-container">
                <div class="settings-nav">
                    <div class="settings-nav-item active" data-section="profile">
                        <i class="fa-solid fa-user"></i> Профиль
                    </div>
                    <div class="settings-nav-item" data-section="account">
                        <i class="fa-solid fa-key"></i> Аккаунт
                    </div>
                    <div class="settings-nav-item" data-section="notifications">
                        <i class="fa-solid fa-bell"></i> Уведомления
                    </div>
                    <div class="settings-nav-item" data-section="privacy">
                        <i class="fa-solid fa-shield"></i> Приватность
                    </div>
                    <div class="settings-nav-item" data-section="preferences">
                        <i class="fa-solid fa-sliders"></i> Предпочтения
                    </div>
                    <div class="settings-nav-item" data-section="help">
                        <i class="fa-solid fa-circle-question"></i> Помощь
                    </div>
                </div>
                
                <div class="settings-content">
                    <!-- Секция профиля -->
                    <div class="settings-section active" id="settings-profile">
                        <h3>Настройки профиля</h3>
                        <div class="form-row">
                            <div class="input-group">
                                <label>Имя</label>
                                <input type="text" id="settings-firstname" value="Алексей">
                            </div>
                            <div class="input-group">
                                <label>Фамилия</label>
                                <input type="text" id="settings-lastname" value="Петров">
                            </div>
                        </div>
                        <div class="input-group">
                            <label>Email</label>
                            <input type="email" id="settings-email" value="alexey@example.com">
                        </div>
                        <div class="input-group">
                            <label>О себе</label>
                            <textarea id="settings-bio" placeholder="Расскажите о себе...">Люблю активный образ жизни и постоянно работаю над собой!</textarea>
                        </div>
                        <button class="btn-primary">Сохранить изменения</button>
                    </div>
                    
                    <!-- Секция аккаунта -->
                    <div class="settings-section" id="settings-account">
                        <h3>Настройки аккаунта</h3>
                        <div class="input-group">
                            <label>Язык</label>
                            <select id="settings-language">
                                <option value="ru" selected>Русский</option>
                                <option value="en">English</option>
                                <option value="es">Español</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Единицы измерения</label>
                            <div class="radio-group">
                                <label class="radio-card">
                                    <input type="radio" name="units" value="metric" checked>
                                    <span>Метрические (кг, см)</span>
                                </label>
                                <label class="radio-card">
                                    <input type="radio" name="units" value="imperial">
                                    <span>Имперские (фунты, дюймы)</span>
                                </label>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>Часовой пояс</label>
                            <select id="settings-timezone">
                                <option value="+3" selected>Москва (UTC+3)</option>
                                <option value="+4">Самара (UTC+4)</option>
                                <option value="+5">Екатеринбург (UTC+5)</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Секция уведомлений -->
                    <div class="settings-section" id="settings-notifications">
                        <h3>Настройки уведомлений</h3>
                        <div class="input-group">
                            <label class="d-flex justify-between align-center">
                                <span>Уведомления о тренировках</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </label>
                        </div>
                        <div class="input-group">
                            <label class="d-flex justify-between align-center">
                                <span>Напоминания о замерах</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </label>
                        </div>
                        <div class="input-group">
                            <label class="d-flex justify-between align-center">
                                <span>Советы по питанию</span>
                                <label class="toggle-switch">
                                    <input type="checkbox">
                                    <span class="toggle-slider"></span>
                                </label>
                            </label>
                        </div>
                        <div class="input-group">
                            <label class="d-flex justify-between align-center">
                                <span>Новости сообщества</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>
    
    <div class="notification-container" id="notification-container"></div>
    
    <!-- Модальное окно для создания поста -->
    <div class="modal-overlay" id="post-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>Новая запись в сообществе</h3>
                <button class="modal-close" onclick="app.closeModal('post-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label>Заголовок</label>
                    <input type="text" id="post-title" placeholder="О чем вы хотите рассказать?">
                </div>
                <div class="input-group">
                    <label>Содержание</label>
                    <textarea id="post-content" placeholder="Поделитесь своими успехами, задайте вопрос или поддержите других..." rows="5"></textarea>
                </div>
                <button class="btn-primary w-100" onclick="app.publishPost()">Опубликовать</button>
            </div>
        </div>
    </div>

    <script>
        // ================= CONFIGURATION =================
        const GOOGLE_API_KEY = 'AIzaSyDINaYT_SPUfYFBtOWdZp97WmwNgWLIYNA';
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-pro:generateContent";

        // ================= STATE MANAGEMENT =================
        const state = {
            step: 1,
            totalSteps: 7,
            userData: {},
            workoutPlan: null,
            chatHistory: [],
            measurements: [],
            communityPosts: [],
            settings: {
                notifications: true,
                units: 'metric',
                language: 'ru'
            }
        };

        // ================= GEMINI API SERVICE =================
        class GeminiService {
            constructor(apiKey) {
                this.apiKey = apiKey;
            }

            async generatePlan(userData) {
                // Формирование сложного системного промпта
                const prompt = `
                    Ты профессиональный фитнес-тренер с 20-летним стажем. Твоя задача - составить идеальный план тренировок.
                    
                    ПРОФИЛЬ КЛИЕНТА:
                    - Пол: ${userData.gender}
                    - Возраст: ${userData.age}
                    - Вес: ${userData.weight}кг, Рост: ${userData.height}см
                    - Телосложение: ${userData.body_type}
                    - Место: ${userData.location}
                    - Инвентарь: ${Array.isArray(userData.equipment) ? userData.equipment.join(', ') : userData.equipment}
                    - Уровень: ${userData.level}
                    - Ограничения/Болезни: ${userData.injuries}
                    - Частота: ${userData.days_per_week} раз в неделю
                    - Время на тренировку: ${userData.duration} минут
                    - Цель: ${userData.goal}
                    - Интенсивность: ${userData.intensity}
                    - Предпочтения: ${Array.isArray(userData.training_preferences) ? userData.training_preferences.join(', ') : userData.training_preferences}
                    - Специфические цели: ${Array.isArray(userData.specific_goals) ? userData.specific_goals.join(', ') : userData.specific_goals}

                    ЗАДАЧА:
                    Создай JSON объект (БЕЗ MARKDOWN, только чистый JSON), содержащий подробную программу.
                    Структура JSON должна быть следующей:
                    {
                        "summary": "Краткий анализ формы и совет (макс 100 слов)",
                        "schedule": [
                            {
                                "day": "День 1 - Грудные и Трицепс",
                                "focus": "Силовая",
                                "duration": "60 минут",
                                "exercises": [
                                    {
                                        "name": "Жим лежа",
                                        "sets": "3",
                                        "reps": "8-12",
                                        "weight_guide": "70% от 1ПМ",
                                        "instruction": "Лопатки сведены, локти 45 градусов.",
                                        "rest": "60-90 сек"
                                    }
                                ]
                            }
                        ],
                        "recommendations": {
                            "cardio": "15-20 минут после силовой",
                            "stretching": "10 минут после тренировки",
                            "notes": "Следите за техникой"
                        }
                    }
                    В массиве schedule должно быть ровно ${userData.days_per_week} дней.
                    Подбирай упражнения строго исходя из инвентаря: "${Array.isArray(userData.equipment) ? userData.equipment.join(', ') : userData.equipment}".
                    Если есть травмы ("${userData.injuries}"), исключи опасные упражнения.
                    
                    ВЕРНИ ТОЛЬКО JSON.
                `;

                try {
                    const response = await fetch(`${API_URL}?key=${this.apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }]
                        })
                    });

                    if (!response.ok) throw new Error('API Error');
                    
                    const data = await response.json();
                    const text = data.candidates[0].content.parts[0].text;
                    
                    // Очистка от markdown блоков кода если они есть
                    const jsonStr = text.replace(/```json/g, '').replace(/```/g, '').trim();
                    return JSON.parse(jsonStr);

                } catch (error) {
                    console.error('API Error:', error);
                    throw new Error('Ошибка связи с ИИ. Проверьте API ключ.');
                }
            }

            async chat(message, context) {
                // Упрощенный чат без сложной истории для экономии токенов в демо
                const prompt = `
                    Ты фитнес-тренер. Контекст плана тренировок пользователя уже известен.
                    Вопрос пользователя: "${message}"
                    Ответь кратко, профессионально и мотивирующе.
                `;
                
                try {
                    const response = await fetch(`${API_URL}?key=${this.apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }]
                        })
                    });
                    const data = await response.json();
                    return data.candidates[0].content.parts[0].text;
                } catch (e) {
                    return "Извини, я сейчас не могу ответить. Попробуй позже.";
                }
            }
        }

        // ================= UI MANAGER =================
        const app = {
            gemini: new GeminiService(GOOGLE_API_KEY),

            init() {
                this.bindEvents();
                this.updateWizardUI();
                this.createParticles();
                this.loadUserData();
                this.setupScrollListener();
            },

            bindEvents() {
                // Навигация
                document.getElementById('nav-home').onclick = () => this.switchScreen('welcome');
                document.getElementById('nav-plan').onclick = () => this.switchScreen('plan');
                document.getElementById('nav-progress').onclick = () => this.switchScreen('progress');
                document.getElementById('nav-nutrition').onclick = () => this.switchScreen('nutrition');
                document.getElementById('nav-chat').onclick = () => this.switchScreen('chat');
                document.getElementById('nav-community').onclick = () => this.switchScreen('community');
                document.getElementById('nav-settings').onclick = () => this.switchScreen('settings');

                // Wizard Buttons
                document.getElementById('next-btn').onclick = () => this.nextStep();
                document.getElementById('prev-btn').onclick = () => this.prevStep();
                
                // Form Submit
                document.getElementById('onboarding-form').onsubmit = (e) => {
                    e.preventDefault();
                    this.handleFormSubmit();
                };

                // Chat
                document.getElementById('send-msg-btn').onclick = () => this.sendMessage();
                document.getElementById('chat-input').onkeypress = (e) => {
                    if (e.key === 'Enter') this.sendMessage();
                };

                // Settings navigation
                document.querySelectorAll('.settings-nav-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const section = item.dataset.section;
                        this.switchSettingsSection(section);
                    });
                });
            },

            setupScrollListener() {
                window.addEventListener('scroll', () => {
                    const navbar = document.getElementById('navbar');
                    if (window.scrollY > 50) {
                        navbar.classList.add('scrolled');
                    } else {
                        navbar.classList.remove('scrolled');
                    }
                });
            },

            createParticles() {
                const container = document.getElementById('particles-container');
                const particleCount = 30;
                
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    
                    // Случайные свойства
                    const size = Math.random() * 5 + 2;
                    const left = Math.random() * 100;
                    const animationDuration = Math.random() * 20 + 10;
                    const animationDelay = Math.random() * 20;
                    const opacity = Math.random() * 0.3 + 0.1;
                    
                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    particle.style.left = `${left}%`;
                    particle.style.animationDuration = `${animationDuration}s`;
                    particle.style.animationDelay = `${animationDelay}s`;
                    particle.style.opacity = opacity;
                    
                    // Случайный цвет
                    const colors = ['var(--primary)', 'var(--secondary)', 'var(--accent)'];
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    particle.style.background = color;
                    
                    container.appendChild(particle);
                }
            },

            loadUserData() {
                const savedData = localStorage.getItem('aiFitUserData');
                if (savedData) {
                    state.userData = JSON.parse(savedData);
                    // Включаем кнопки навигации если данные уже есть
                    this.enableNavigation();
                }
            },

            saveUserData() {
                localStorage.setItem('aiFitUserData', JSON.stringify(state.userData));
            },

            enableNavigation() {
                document.getElementById('nav-plan').disabled = false;
                document.getElementById('nav-progress').disabled = false;
                document.getElementById('nav-nutrition').disabled = false;
                document.getElementById('nav-chat').disabled = false;
                document.getElementById('nav-community').disabled = false;
            },

            startOnboarding() {
                this.switchScreen('onboarding');
            },

            switchScreen(screenName) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
                document.getElementById(`screen-${screenName}`).classList.add('active-screen');
                
                // Обновление навбара
                document.querySelectorAll('.nav-links button').forEach(b => b.classList.remove('active'));
                let navId = screenName;
                if (screenName === 'welcome' || screenName === 'onboarding' || screenName === 'loading') {
                    navId = 'home';
                }
                document.getElementById(`nav-${navId}`).classList.add('active');
            },

            switchSettingsSection(sectionName) {
                document.querySelectorAll('.settings-section').forEach(s => s.classList.remove('active'));
                document.getElementById(`settings-${sectionName}`).classList.add('active');
                
                document.querySelectorAll('.settings-nav-item').forEach(item => item.classList.remove('active'));
                document.querySelector(`.settings-nav-item[data-section="${sectionName}"]`).classList.add('active');
            },

            // --- Wizard Logic ---
            nextStep() {
                if (state.step < state.totalSteps) {
                    // Анимация перехода
                    const currentStep = document.querySelector('.wizard-step.active-step');
                    currentStep.classList.remove('active-step');
                    currentStep.classList.add('prev-step');
                    
                    state.step++;
                    this.updateWizardUI();
                    
                    // Прокрутка к верху
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            },

            prevStep() {
                if (state.step > 1) {
                    const currentStep = document.querySelector('.wizard-step.active-step');
                    currentStep.classList.remove('active-step');
                    
                    state.step--;
                    this.updateWizardUI();
                    
                    // Прокрутка к верху
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            },

            updateWizardUI() {
                // Скрыть все шаги
                document.querySelectorAll('.wizard-step').forEach(el => {
                    el.classList.remove('active-step', 'prev-step');
                });
                
                // Показать текущий
                const currentStep = document.querySelector(`.wizard-step[data-step="${state.step}"]`);
                currentStep.classList.add('active-step');
                
                // Прогресс бар
                const progress = (state.step / state.totalSteps) * 100;
                document.getElementById('wizard-progress').style.width = `${progress}%`;

                // Кнопки
                document.getElementById('prev-btn').style.display = state.step === 1 ? 'none' : 'block';
                if (state.step === state.totalSteps) {
                    document.getElementById('next-btn').style.display = 'none';
                    document.getElementById('submit-btn').style.display = 'block';
                } else {
                    document.getElementById('next-btn').style.display = 'block';
                    document.getElementById('submit-btn').style.display = 'none';
                }
            },

            // --- Core Logic ---
            async handleFormSubmit() {
                // Сбор данных формы
                const formData = new FormData(document.getElementById('onboarding-form'));
                
                // Обработка чекбоксов
                const equipment = [];
                const specificGoals = [];
                const trainingPreferences = [];
                const demotivators = [];
                
                formData.forEach((value, key) => {
                    if (key === 'equipment' || key === 'specific_goals' || 
                        key === 'training_preferences' || key === 'demotivators') {
                        if (key === 'equipment') equipment.push(value);
                        if (key === 'specific_goals') specificGoals.push(value);
                        if (key === 'training_preferences') trainingPreferences.push(value);
                        if (key === 'demotivators') demotivators.push(value);
                    } else {
                        state.userData[key] = value;
                    }
                });
                
                state.userData.equipment = equipment;
                state.userData.specific_goals = specificGoals;
                state.userData.training_preferences = trainingPreferences;
                state.userData.demotivators = demotivators;

                // Сохранение данных
                this.saveUserData();

                // Переход на загрузку
                this.switchScreen('loading');
                this.animateLoadingText();

                try {
                    // Запрос к AI для создания плана тренировок
                    const plan = await this.gemini.generatePlan(state.userData);

                    if (plan) {
                        state.workoutPlan = plan;
                        this.renderPlan(plan);
                        
                        // Включаем кнопки меню
                        this.enableNavigation();
                        
                        this.switchScreen('plan');
                        this.showNotification('Персональный план тренировок успешно создан!', 'success');
                    } else {
                        this.switchScreen('onboarding');
                    }
                } catch (error) {
                    this.showNotification(error.message, 'error');
                    this.switchScreen('onboarding');
                }
            },

            animateLoadingText() {
                const texts = [
                    "Анализ ваших данных...",
                    "Проверка медицинских ограничений...",
                    "Подбор упражнений под ваш инвентарь...",
                    "Оптимизация плана под ваши цели...",
                    "Расчет рабочих весов и подходов...",
                    "Создание рекомендаций по технике...",
                    "Формирование итогового плана..."
                ];
                let i = 0;
                const interval = setInterval(() => {
                    if (!document.getElementById('screen-loading').classList.contains('active-screen')) {
                        clearInterval(interval);
                        return;
                    }
                    document.getElementById('loading-text').innerText = texts[i % texts.length];
                    i++;
                }, 2000);
            },

            renderPlan(data) {
                const container = document.getElementById('plan-container');
                
                // Очистка контейнера
                container.innerHTML = '';
                
                // Добавление сводки
                if (data.summary) {
                    const summaryCard = document.createElement('div');
                    summaryCard.className = 'day-card';
                    summaryCard.style.borderColor = 'var(--primary)';
                    summaryCard.innerHTML = `
                        <div class="day-header">
                            <h3><i class="fa-solid fa-clipboard-check"></i> Вердикт тренера</h3>
                        </div>
                        <div class="day-body">
                            <p>${data.summary}</p>
                        </div>
                    `;
                    container.appendChild(summaryCard);
                }

                // Добавление дней тренировок
                if (data.schedule && Array.isArray(data.schedule)) {
                    data.schedule.forEach((day, index) => {
                        let exercisesHtml = '';
                        
                        if (day.exercises && Array.isArray(day.exercises)) {
                            day.exercises.forEach(ex => {
                                exercisesHtml += `
                                    <div class="exercise-item">
                                        <div class="ex-name">
                                            ${ex.name}
                                            <small>${ex.instruction || 'Следите за техникой выполнения'}</small>
                                        </div>
                                        <div class="ex-meta">
                                            ${ex.sets || '3'} x ${ex.reps || '8-12'}
                                        </div>
                                        <div class="ex-meta" style="color: var(--text-muted); font-size: 0.9rem;">
                                            ${ex.weight_guide || 'По ощущениям'}
                                        </div>
                                        <div class="ex-actions">
                                            <button class="ex-action-btn" title="Детали">
                                                <i class="fa-solid fa-info"></i>
                                            </button>
                                            <button class="ex-action-btn" title="Отметить выполненным">
                                                <i class="fa-solid fa-check"></i>
                                            </button>
                                        </div>
                                    </div>
                                `;
                            });
                        }

                        const dayHtml = `
                            <div class="day-card">
                                <div class="day-header">
                                    <h3>${day.day || `День ${index + 1}`}</h3>
                                    <span style="color: var(--text-muted)">${day.focus || 'Силовая тренировка'} • ${day.duration || '60 мин'}</span>
                                </div>
                                <div class="day-body">
                                    ${exercisesHtml || '<p>Упражнения будут добавлены скоро</p>'}
                                </div>
                            </div>
                        `;
                        container.innerHTML += dayHtml;
                    });
                }

                // Добавление рекомендаций
                if (data.recommendations) {
                    const recCard = document.createElement('div');
                    recCard.className = 'day-card';
                    recCard.innerHTML = `
                        <div class="day-header">
                            <h3><i class="fa-solid fa-lightbulb"></i> Рекомендации</h3>
                        </div>
                        <div class="day-body">
                            <p><strong>Кардио:</strong> ${data.recommendations.cardio || '15-20 минут после силовой тренировки'}</p>
                            <p><strong>Растяжка:</strong> ${data.recommendations.stretching || '10 минут после тренировки'}</p>
                            <p><strong>Примечания:</strong> ${data.recommendations.notes || 'Следите за техникой и пейте воду'}</p>
                        </div>
                    `;
                    container.appendChild(recCard);
                }
            },

            // --- Progress Tracking ---
            logProgress() {
                this.showNotification('Функция добавления замеров будет доступна в следующем обновлении', 'info');
            },

            saveMeasurements() {
                const weight = document.getElementById('input-weight').value;
                const chest = document.getElementById('input-chest').value;
                const waist = document.getElementById('input-waist').value;
                const hips = document.getElementById('input-hips').value;
                const biceps = document.getElementById('input-biceps').value;
                const date = document.getElementById('input-date').value || new Date().toISOString().split('T')[0];
                
                if (!weight) {
                    this.showNotification('Пожалуйста, введите хотя бы вес', 'warning');
                    return;
                }
                
                const measurement = {
                    date,
                    weight: parseFloat(weight),
                    chest: chest ? parseFloat(chest) : null,
                    waist: waist ? parseFloat(waist) : null,
                    hips: hips ? parseFloat(hips) : null,
                    biceps: biceps ? parseFloat(biceps) : null
                };
                
                state.measurements.push(measurement);
                localStorage.setItem('aiFitMeasurements', JSON.stringify(state.measurements));
                
                this.showNotification('Замеры успешно сохранены!', 'success');
                
                // Очистка полей
                document.getElementById('input-weight').value = '';
                document.getElementById('input-chest').value = '';
                document.getElementById('input-waist').value = '';
                document.getElementById('input-hips').value = '';
                document.getElementById('input-biceps').value = '';
            },

            // --- Nutrition ---
            generateMealPlan() {
                this.showNotification('Генерация персонального плана питания...', 'info');
                // В реальном приложении здесь был бы запрос к API
                setTimeout(() => {
                    this.showNotification('План питания успешно обновлен!', 'success');
                }, 2000);
            },

            // --- Chat Logic ---
            async sendMessage() {
                const input = document.getElementById('chat-input');
                const text = input.value.trim();
                if (!text) return;

                // Рендер сообщения пользователя
                this.appendMessage(text, 'user');
                input.value = '';

                // Индикатор набора
                const botMsgDiv = this.appendMessage('Печатает...', 'bot');

                try {
                    // Запрос к API
                    const reply = await this.gemini.chat(text, {
                        userData: state.userData,
                        workoutPlan: state.workoutPlan
                    });
                    
                    // Обновление сообщения бота
                    botMsgDiv.innerText = reply;
                } catch (error) {
                    botMsgDiv.innerText = "Извините, произошла ошибка. Пожалуйста, попробуйте позже.";
                }
            },

            appendMessage(text, sender) {
                const history = document.getElementById('chat-history');
                const div = document.createElement('div');
                div.className = `message ${sender}`;
                
                const time = new Date().toLocaleTimeString('ru-RU', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                div.innerHTML = `
                    ${text}
                    <div class="message-time">${time}</div>
                `;
                
                history.appendChild(div);
                history.scrollTop = history.scrollHeight;
                return div;
            },

            clearChat() {
                const history = document.getElementById('chat-history');
                history.innerHTML = `
                    <div class="message bot">
                        История очищена. Чем могу помочь?
                        <div class="message-time">Только что</div>
                    </div>
                `;
            },

            voiceInput() {
                this.showNotification('Голосовой ввод будет доступен в следующем обновлении', 'info');
            },

            // --- Community ---
            createPost() {
                this.openModal('post-modal');
            },

            publishPost() {
                const title = document.getElementById('post-title').value;
                const content = document.getElementById('post-content').value;
                
                if (!title || !content) {
                    this.showNotification('Пожалуйста, заполните все поля', 'warning');
                    return;
                }
                
                const post = {
                    title,
                    content,
                    author: state.userData.firstname || 'Пользователь',
                    date: new Date().toLocaleDateString('ru-RU'),
                    likes: 0,
                    comments: []
                };
                
                state.communityPosts.unshift(post);
                localStorage.setItem('aiFitCommunityPosts', JSON.stringify(state.communityPosts));
                
                this.showNotification('Запись опубликована!', 'success');
                this.closeModal('post-modal');
                
                // Очистка полей
                document.getElementById('post-title').value = '';
                document.getElementById('post-content').value = '';
            },

            // --- Modal Management ---
            openModal(modalId) {
                document.getElementById(modalId).classList.add('active');
            },

            closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
            },

            // --- Utility Functions ---
            downloadPDF() {
                this.showNotification('Функция экспорта в PDF будет доступна в следующем обновлении', 'info');
            },

            sharePlan() {
                if (navigator.share) {
                    navigator.share({
                        title: 'Мой план тренировок от AI-Fit Pro',
                        text: 'Посмотрите мой персональный план тренировок, созданный ИИ!',
                        url: window.location.href
                    })
                    .catch(error => console.log('Error sharing:', error));
                } else {
                    this.showNotification('Функция "Поделиться" не поддерживается вашим браузером', 'warning');
                }
            },

            regeneratePlan() {
                this.showNotification('Запрос на обновление плана отправлен ИИ...', 'info');
                // В реальном приложении здесь был бы запрос к API для генерации нового плана
                setTimeout(() => {
                    this.showNotification('План тренировок успешно обновлен!', 'success');
                }, 3000);
            },

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <div class="notification-icon">
                        <i class="fa-solid fa-${type === 'error' ? 'exclamation-triangle' : type === 'success' ? 'check-circle' : 'info-circle'}"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">${type === 'error' ? 'Ошибка' : type === 'success' ? 'Успех' : 'Информация'}</div>
                        <div class="notification-message">${message}</div>
                    </div>
                    <button class="notification-close" onclick="this.parentElement.remove()">
                        <i class="fa-solid fa-times"></i>
                    </button>
                `;

                document.getElementById('notification-container').appendChild(notification);
                
                // Автоудаление через 5 секунд
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 5000);
            }
        };

        // Запуск приложения
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
            
            // Установка текущей даты в поле даты
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('input-date');
            if (dateInput) {
                dateInput.value = today;
                dateInput.max = today; // Не позволяем выбирать будущие даты
            }
        });

        // Обработка изменения размеров окна
        window.addEventListener('resize', () => {
            // Можно добавить адаптивную логику при необходимости
        });
    </script>
</body>
</html>